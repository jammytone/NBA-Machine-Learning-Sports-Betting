<!doctype html>
<html lang="ko" data-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>NBA Î®∏Ïã†Îü¨Îãù ÏòàÏ∏°</title>
    <style>
        .bankroll-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            color: white;
            padding: 0.5rem 1rem;
            margin-bottom: 1rem;
        }
        .bankroll-input:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.5);
        }
        
        /* Î™®Î∞îÏùº ÏµúÏ†ÅÌôî Ïä§ÌÉÄÏùº */
        @media (max-width: 768px) {
            .game-table {
                font-size: 0.875rem;
            }
            .stats-value {
                font-size: 0.75rem;
            }
            .sportsbook-cell {
                padding: 0.5rem 0.25rem;
            }
            .team-name {
                font-size: 0.875rem;
            }
        }

        /* Ïä§ÌÅ¨Î°§ ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -1rem;
            padding: 0 1rem;
        }

        /* Íµ¨Î∂ÑÏÑ† Ïä§ÌÉÄÏùº */
        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.1), transparent);
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen">
    <main class="relative isolate px-4 py-6 sm:px-6 lg:px-8">
        <!-- Ìó§Îçî ÏÑπÏÖò -->
        <section class="mx-auto max-w-7xl">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-medium text-white mb-6">
                üèÄ NBA AI Î™®Îç∏ ÏòàÏ∏° <span class="text-gray-400 text-lg sm:text-xl md:text-2xl">({{ today }})</span>
            </h1>

            <!-- Î±ÖÌÅ¨Î°§ ÏûÖÎ†• ÏÑπÏÖò -->
            <div class="mb-8">
                <label for="bankroll" class="block text-sm font-medium text-gray-400 mb-2">Ï†ÑÏ≤¥ Î±ÖÌÅ¨Î°§ Í∏àÏï° (‚Ç©)</label>
                <input type="number" id="bankroll" 
                       class="bankroll-input w-full sm:w-48" 
                       placeholder="Ïòà: 1000000" 
                       oninput="updateBetAmounts(this.value)">
            </div>

            <!-- Î©îÏù∏ ÌÖåÏù¥Î∏î ÏÑπÏÖò -->
            <div class="table-container rounded-xl bg-white/5 backdrop-blur-lg">
                <table class="min-w-full divide-y divide-gray-700 game-table">
                    <!-- ÌÖåÏù¥Î∏î Ìó§Îçî -->
                    <thead>
                        <tr>
                            <th class="py-3 px-4 text-left text-sm sm:text-base font-semibold text-white">Teams</th>
                            <th class="py-3 px-2 sm:px-4 text-left text-sm sm:text-base font-semibold text-white">Fanduel</th>
                            <th class="py-3 px-2 sm:px-4 text-left text-sm sm:text-base font-semibold text-white hidden md:table-cell">Draft Kings</th>
                            <th class="py-3 px-2 sm:px-4 text-left text-sm sm:text-base font-semibold text-white hidden lg:table-cell">BetMGM</th>
                        </tr>
                    </thead>

                    <!-- ÌÖåÏù¥Î∏î Î∞îÎîî -->
                    <tbody class="divide-y divide-gray-800">
                        {% for game_key in data.get('fanduel') %}
                        {% set teams = game_key.split(':') %}
                        <tr class="hover:bg-white/5 transition-colors">
                            <!-- ÌåÄ Ï†ïÎ≥¥ -->
                            <td class="py-4 px-4">
                                <div class="flex flex-col space-y-2">
                                    <span class="team-name text-white">{{ teams[0] }}</span>
                                    <span class="team-name text-white"><span class="text-gray-500">@</span> {{ teams[1] }}</span>
                                </div>
                            </td>

                            <!-- Ïä§Ìè¨Ï∏†Î∂Å Îç∞Ïù¥ÌÑ∞ -->
                            {% for sportsbook in ['fanduel', 'draftkings', 'betmgm'] %}
                            {% set sbgame = data.get(sportsbook)[game_key] %}
                            <td class="sportsbook-cell px-2 sm:px-4 {% if sportsbook != 'fanduel' %}hidden md:table-cell{% endif %}">
                                {% if sbgame and sbgame.away_team %}
                                <div class="space-y-4">
                                    <!-- ÏõêÏ†ïÌåÄ Îç∞Ïù¥ÌÑ∞ -->
                                    <div class="stats-container">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <span class="stats-value text-white">
                                                    {% if sbgame.away_team_odds|int > 0 %}+{% endif %}{{ sbgame.away_team_odds }}
                                                </span>
                                                {% if sbgame.away_confidence %}
                                                <span class="stats-value text-gray-400">({{ sbgame.away_confidence }}%)</span>
                                                {% endif %}
                                            </div>
                                            <span class="stats-value text-gray-400">EV: {{ sbgame.away_team_ev }}</span>
                                        </div>
                                        {% if sbgame.away_kelly %}
                                        <div class="kelly-container mt-1">
                                            <div class="flex flex-col space-y-1">
                                                <div class="stats-value text-gray-400">
                                                    ÏºàÎ¶¨: <span class="full-kelly">{{ sbgame.away_kelly }}</span>% / 
                                                    <span class="half-kelly">{{ "%.1f"|format(sbgame.away_kelly/2) }}</span>%
                                                </div>
                                                <div class="bet-amounts stats-value text-emerald-500 hidden">
                                                    Î≤†ÌåÖ: <span class="full-bet">0</span> / <span class="half-bet">0</span>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>

                                    <div class="divider"></div>

                                    <!-- ÌôàÌåÄ Îç∞Ïù¥ÌÑ∞ -->
                                    <div class="stats-container">
                                        <div class="flex items-center space-x-2">
                                            <span class="stats-value text-white">
                                                {% if sbgame.home_team_odds|int > 0 %}+{% endif %}{{ sbgame.home_team_odds }}
                                            </span>
                                            {% if sbgame.home_confidence %}
                                            <span class="stats-value text-gray-400">({{ sbgame.home_confidence }}%)</span>
                                            {% endif %}
                                        </div>
                                        {% if sbgame.home_kelly %}
                                        <div class="kelly-container mt-1">
                                            <div class="stats-value text-gray-400">
                                                ÏºàÎ¶¨: {{ sbgame.home_kelly }}% / {{ "%.1f"|format(sbgame.home_kelly/2) }}%
                                            </div>
                                            <div class="bet-amounts stats-value text-gray-400 hidden">
                                                Î≤†ÌåÖ: <span class="full-bet">0</span> / <span class="half-bet">0</span>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Î∞∞Í≤Ω Ìö®Í≥º -->
        <div class="absolute inset-x-0 -top-16 -z-10 flex transform-gpu justify-center overflow-hidden blur-3xl">
            <div class="aspect-[1318/752] w-[82.375rem] flex-none bg-gradient-to-r from-[#80caff] to-[#4f46e5] opacity-15"></div>
        </div>
    </main>

    <script>
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW',
                maximumFractionDigits: 0
            }).format(amount);
        }

        function updateBetAmounts(bankroll) {
            if (!bankroll || isNaN(bankroll)) return;
            bankroll = parseFloat(bankroll);
            
            document.querySelectorAll('.kelly-container').forEach(container => {
                // ÏºàÎ¶¨ Í∞í Ï∞æÍ∏∞
                const kellyText = container.textContent;
                const kellyMatch = kellyText.match(/ÏºàÎ¶¨: ([\d.]+)% \/ ([\d.]+)%/);
                
                if (kellyMatch) {
                    const fullKelly = parseFloat(kellyMatch[1]);
                    const halfKelly = parseFloat(kellyMatch[2]);
                    
                    // Î≤†ÌåÖ Í∏àÏï° Í≥ÑÏÇ∞
                    const fullAmount = Math.round(bankroll * (fullKelly / 100));
                    const halfAmount = Math.round(bankroll * (halfKelly / 100));
                    
                    // Î≤†ÌåÖ Í∏àÏï° ÏóÖÎç∞Ïù¥Ìä∏
                    const betAmountsDiv = container.querySelector('.bet-amounts');
                    if (betAmountsDiv) {
                        const fullBet = betAmountsDiv.querySelector('.full-bet');
                        const halfBet = betAmountsDiv.querySelector('.half-bet');
                        
                        if (fullBet && halfBet) {
                            fullBet.textContent = formatCurrency(fullAmount);
                            halfBet.textContent = formatCurrency(halfAmount);
                            betAmountsDiv.classList.remove('hidden');
                        }
                    }
                }
            });
        }

        // EV Í∞íÏóê Îî∞Î•∏ ÏÉâÏÉÅ Ï†ÅÏö©
        document.querySelectorAll('.stats-value').forEach(el => {
            const evText = el.textContent;
            if (evText.includes('EV:')) {
                const ev = parseFloat(evText.split('EV:')[1]);
                if (ev > 5) {
                    el.classList.add('text-green-500');
                } else if (ev > 0) {
                    el.classList.add('text-emerald-500');
                } else if (ev > -15) {
                    el.classList.add('text-orange-500');
                } else {
                    el.classList.add('text-red-500');
                }
            }
        });

        // ÏûÖÎ†• ÌïÑÎìú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        const bankrollInput = document.getElementById('bankroll');
        if (bankrollInput) {
            bankrollInput.addEventListener('input', (e) => {
                const value = e.target.value.replace(/[^0-9]/g, '');
                updateBetAmounts(value);
            });
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded');
            const bankrollInput = document.getElementById('bankroll');
            if (bankrollInput && bankrollInput.value) {
                console.log('Updating initial bet amounts');
                updateBetAmounts(bankrollInput.value);
            }
        });
    </script>
</body>
</html>
